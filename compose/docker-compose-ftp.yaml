#################################################################################
##
##    Docker Compose File: FTP Stack (Server + Client)
##
##    Function: Local FTP server with web-based FileZilla client
##
##    Documentation: https://github.com/garethflowers/docker-ftp-server
##                   https://github.com/jlesage/docker-filezilla
##
#################################################################################

name: ${FTP_PROJECT_NAME:-ftp-stack}


services:
  ftp-server:
    image: stilliard/pure-ftpd:latest
    container_name: ftp-server
    restart: unless-stopped
    environment:
      - PUBLICHOST=${FTP_PASV_ADDRESS:?err}
      - FTP_USER_NAME=${FTP_USER:?err}
      - FTP_USER_PASS=${FTP_PASS:?err}
      - FTP_USER_HOME=/home/ftpuser
      - FTP_PASSIVE_PORTS=40000:40009
      - ADDED_FLAGS=-d -d
    volumes:
      - ${FOLDER_FOR_FTP_STORAGE:?err}:/home/ftpuser:rw
    ports:
      - "20:20"
      - "21:21"
      - "40000-40009:40000-40009"
    networks:
      - ftp-network
    labels:
      - "autoheal=true"

  ftp-client:
    image: jlesage/filezilla:latest
    container_name: ftp-client
    restart: unless-stopped
    environment:
      - PUID=${PUID:?err}
      - PGID=${PGID:?err}
      - TZ=${TIMEZONE:?err}
      - DISPLAY_WIDTH=1920
      - DISPLAY_HEIGHT=1080
      - VNC_PASSWORD=${FTP_VNC_PASSWORD:-}
    volumes:
      - ${FOLDER_FOR_CONFIG_DATA:?err}/ftp-client:/config:rw
      - ${FOLDER_FOR_MEDIA:?err}:/shared:ro
    ports:
      - "${WEBUI_PORT_FTP_CLIENT:?err}:5800"
    networks:
      - ftp-network
    labels:
      - "autoheal=true"

networks:
  ftp-network:
    driver: bridge